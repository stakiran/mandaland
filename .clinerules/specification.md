# マンダランド

## 画面構成

### トップ画面
- マンダランドの一覧を表示する画面
- マンダランドの新規、オープン、削除ができる
- キー操作:
    - n キーで新規
    - space キーでリネーム
    - enter キーでオープン
    - delete キーで削除
    - up/down で選択。端から端へのループもサポートする

### メイン画面
一つのマンダランドを表示・操作する画面。

下記のように 3 レイヤーで表示する。

```
layer1: [mandaland-name] [tier-indicator]
leyer2: [mandal-pane]
layer3 [mass-editor]
```

layer1:

- mandaland-name には今開いているマンダランドの名前を表示する
- tier-indicator には、今開いてるマンダラのホップ数（何回エンターしているか）を表示する

layer2:

- mandal-pane には、今開いているマンダラを表示する
- 3 x 3 の 9 マスを横幅目一杯使って表示し、マスの内容は中央揃えかつ折り返して表示する。十分大きなフォントで表示する。改行や空行も正しく反映して表示する。
- 各マスの枠線は見やすい線にする
- カレントポイントが指すマスは、マスの枠を強調表示する
- コアの内容（マス5の内容）も強調表示する

layer3:

- mass-editor は、現在カレントポイントが指しているマスの内容を閲覧・編集するテキストエディットを提供する
- 日本語に対応した等幅フォントを使う
- カレントポイントが指すマスの内容をリアルタイムで表示する
- マスの内容は自動保存する
    - 自動保存は 2 パターンある。パターン 1 がフォーカスが外れたときに保存。パターン 2 が 10 秒ごとに内容差分を確認して差分があれば保存

キー操作:

- まずフォーカスが mandal-pane にある時と、mass-editor にある時とで挙動が異なる
- フォーカスが mandal-pane にある場合:
    - up/down/right/left キーでカレントのマスをムーブする。また端から端へのループもサポートする
    - e キーで Write を行う。フォーカスを mass-editor に移す
    - space キーでカレントのマスからエンターする。ただしマスの内容が空のときはエンターはできません
    - o キーで外部ジャンプを行う
    - backspace キーでリターンを行う
    - delete キーで現在のマンダラを削除してリターンを行う。ただし確認ダイアログを出してください。No の場合はキャンセルしてください
- フォーカスが mass-editor にあるとき
    - esc キーでフォーカスを mandal-pane に移す

## 実装
- index.html のみで構成する
- データの保存には Indexed DB を使う
- concept.md のデータ構造はモデルとして定義し、将来 API 化できるようにしておく
